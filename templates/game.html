{{define "game"}}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Click Trainer - Target Game</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/favicon.ico">
</head>

<body hx-ext="sse" sse-connect="/room/events" data-scene="{{.Scene}}">
    <div class="gradient-overlay"></div>
    <div class="parallax-container">
        <div class="parallax-layer stars"></div>
        <div class="parallax-layer cloud-1">
            <img src="/static/cloud-1.svg" />
            <img src="/static/cloud-1.svg" />
        </div>
        <div class="parallax-layer cloud-2">
            <img src="/static/cloud-2.svg" />
            <img src="/static/cloud-2.svg" />
        </div>
    </div>
    <div class="hills"></div>
    <div class="p-4 h-screen relative" style="z-index:10;">
        <div id="scene"
            class="relative h-full flex flex-col justify-center items-center md:scale-130 lg:scale-160 xl:scale-180 2xl:scale-200 3xl:scale-230 4xl:scale-260">
            {{if eq .Scene "lobby"}}
            {{template "lobby" .}}
            {{else if eq .Scene "recap"}}
            {{template "recap" .Rankings}}
            {{else}}
            {{template "gameContent" .}}
            {{end}}
        </div>
    </div>
    <div sse-swap="swap" hx-swap="true"></div>
    <div sse-swap="sceneChange" style="display:none;" hx-on:htmx:after-swap="document.body.setAttribute('data-scene', this.textContent)"></div>
    <div id="game-content-conn" hx-trigger="sse:update" hx-get="/room/poll" hx-target="#game-content" hx-swap="innerHTML">
    </div>
</body>

</html>
{{end}}

{{define "gameContent"}}

    <div class="flex flex-row items-center gap-4 w-full justify-center">
        {{template "scoreboard" .Players}}
        <div id="timer" class="bg-black/40 text-white rounded-lg p-1 px-2 text-sm font-bold tabular-nums tracking-wider">{{.TimeLeft}}</div>
    </div>
    <div id="game-area" class="relative">
        <div id="targets">
            {{range .Targets}}
            {{template "target" .}}
            {{end}}
            <div sse-swap="newTarget" hx-swap="beforebegin"></div>
        </div>
    </div>

{{end}}

{{define "scoreboard"}}
<div id="scoreboard" sse-swap="scoreboard" hx-swap="outerHTML" class="flex flex-row flex-wrap gap-2 p-1 text-sm">
    {{range .}}
    <div id="player_{{.ID}}" class="flex flex-row items-center gap-2 px-3 py-1.5 rounded-lg" style="background-color:{{.Color}}33; border: 2px solid {{.Color}};">
        <div class="w-3 h-3 rounded-full" style="background-color:{{.Color}}"></div>
        <label class="text-white font-bold">{{ .Name }}</label>
        <div id="player_score_{{ .ID }}" class="bg-white/20 px-2 py-0.5 rounded-md text-white">{{ .Score}}</div>
    </div>
    {{end}}
</div>
{{end}}
